# **Sentry for Astro — Final Notes (Correct & Minimal)**

  

**Docs:** https://docs.sentry.io/platforms/javascript/guides/astro/

---

# **1. Install Sentry**

```
npx astro add @sentry/astro
```

This:

- installs @sentry/astro
    
- adds sentry() to astro.config.ts
    
- does **not** create config files → you must create them
    

---

# **2. Required Sentry Files (You MUST have both)**

  

Create these **in the project root**:

```
sentry.client.config.js
sentry.server.config.js
```

|**File**|**Runs In**|**Purpose**|
|---|---|---|
|sentry.client.config.js|Browser|Catch frontend errors|
|sentry.server.config.js|Server / SSR|Catch backend errors|

Astro has **two runtimes**, so Sentry must be initialized twice.

---

# **3. Client SDK — sentry.client.config.js**

```js
import * as Sentry from "@sentry/astro";

Sentry.init({
  dsn: import.meta.env.PUBLIC_SENTRY_DSN,

  sendDefaultPii: false,
  tracesSampleRate: 0,
  replaysSessionSampleRate: 0,
  replaysOnErrorSampleRate: 0,
});
```

---

# **4. Server SDK — sentry.server.config.js**

```js
import * as Sentry from "@sentry/astro";

Sentry.init({
  dsn: import.meta.env.PUBLIC_SENTRY_DSN,

  sendDefaultPii: false,
  tracesSampleRate: 0,
});
```

---

# **5. astro.config.ts — Minimal + Correct**

  

You already added this, but this is the correct minimal version:

```ts
import { defineConfig } from "astro/config";
import sentry from "@sentry/astro";
import react from "@astrojs/react";
import tailwindcss from "@tailwindcss/vite";
import vercel from "@astrojs/vercel";

export default defineConfig({
  output: "server",
  adapter: vercel(),
  vite: { plugins: [tailwindcss()] },
  integrations: [react(), sentry()],
});
```

**Important:**

✔ No DSN here

✔ No auth token here

✔ No org/project here

Those belong in the config files + Vercel env vars only.

---

# **6. Environment Variables (Vercel)**

  

You must add **both** to Vercel:

  

### **1. PUBLIC_SENTRY_DSN**

  

From your Sentry project page → “Client Keys (DSN)”

  

Example:

```
PUBLIC_SENTRY_DSN=https://xxxx.ingest.de.sentry.io/yyyy
```

### **2. SENTRY_AUTH_TOKEN**

  

Used _only for sourcemap uploads during Vercel builds_

Never exposed to browser.

  

Your token:

```
SENTRY_AUTH_TOKEN=sntrys_xxxxxxxxxxxxx
```

---

# **7. Why You Need Both Variables**

|**Variable**|**Used Where?**|**Purpose**|
|---|---|---|
|**PUBLIC_SENTRY_DSN**|client + server|Connects the SDK to your Sentry project|
|**SENTRY_AUTH_TOKEN**|_Vercel build machine only_|Uploads source maps → readable stack traces|

---

# **8. Testing Sentry**

  

Add this to any Astro page:

```html
<button onclick="throw new Error('Test Astro Error')">Test Error</button>
```

Run:

```bash
npm run dev
```

Click → check Sentry dashboard.

---

## **9. Optional: Environment & Release (Client-Safe)**

  

If you want to explicitly set **environment** or **release**, they must follow the same rules as the DSN.

  

**Important rule:**

Anything used in sentry.client.config.js must be **browser-safe** and prefixed with PUBLIC_.

---

### **Environment variables**

```env
PUBLIC_SENTRY_ENVIRONMENT=production
PUBLIC_SENTRY_RELEASE=1.0.0
```

These are safe to expose because they contain **no secrets**.

---

### **Client config**

```js
import * as Sentry from "@sentry/astro";

Sentry.init({
  dsn: import.meta.env.PUBLIC_SENTRY_DSN,

  environment: import.meta.env.PUBLIC_SENTRY_ENVIRONMENT,
  release: import.meta.env.PUBLIC_SENTRY_RELEASE,

  sendDefaultPii: false,
  tracesSampleRate: 0,
});
```

---

### **Notes**

- Do **not** use process.env in client config
    
- Do **not** expose secrets (auth tokens) to the browser
    
- This section is optional — Sentry works fine without it
    
