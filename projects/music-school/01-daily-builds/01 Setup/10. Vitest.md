
Docs - https://vitest.dev/config/?utm_source=chatgpt.com
- https://docs.astro.build/en/guides/testing/?utm_source=chatgpt.com
# **1. The .astro import issue (fixed)**

  

You **must** declare a module type for .astro so TypeScript + Vitest can import it.

  

You added:

```
/// <reference types="astro/client" />

declare module "*.astro" {
  const Component: any;
  export default Component;
}
```

This lives in:

```
src/env.d.ts
```

This is required and correct.

---

# **✅** 

# **2. Astro test file using AstroContainer**

  

Your test file:

```ts
import { experimental_AstroContainer as AstroContainer } from "astro/container";
import { expect, test } from "vitest";
import Demo from "./Demo.astro";

test("Demo component renders", async () => {
  const container = await AstroContainer.create();
  const result = await container.renderToString(Demo);

  expect(result).toContain("<div");
});
```

This is the **official test pattern** from Astro’s docs and requires:

- Astro 4.6+ or 5.x
    
- Vitest
    
- The Vite config in step 3
    

  

You did it correctly.

---

# **✅** 

# **3. Vitest configuration for Astro**

  

Your vitest.config.ts (or .js) is correct:

```ts
/// <reference types="vitest/config" />
import { getViteConfig } from "astro/config";

export default getViteConfig({
  test: {
    environment: "happy-dom",
    globals: true,
    include: ["src/**/*.{test,spec}.{ts,tsx,js}"],
  },
});
```

Why needed:

- getViteConfig() merges Astro’s Vite config → **Astro components can compile in tests**
    
- happy-dom lets Astro render HTML without a browser
    
- globals: true allows using test / expect without imports
    

  

This is exactly what Astro’s docs recommend.
---

---

# **✅** 

# **4. tsconfig includes Astro types**

  

Your tsconfig must include this:

```ts
{
  "extends": "astro/tsconfigs/strict",
  "include": [".astro/types.d.ts", "**/*"],
  "compilerOptions": {
    "types": ["astro/client"]
  }
}
```

You already had that.

Correct.
