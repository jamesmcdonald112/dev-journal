### **Resend setup — what we did (brief)**

1. **Created a sending domain in Resend**
    

  

- Picked your domain and region (EU).
    
- Goal: Resend sends _transactional_ emails for your website without touching Zoho inboxes.
    

  

2. **Used a dedicated sending subdomain**
    

  

- Chose **send.musicschoolsites.com** for Return-Path / SPF.
    
- This keeps Resend isolated from your main domain mail (Zoho).
    

  

3. **Added Resend DNS records in SiteGround**
    

  

- **DKIM:** resend._domainkey.musicschoolsites.com (TXT with the long p=... key)
    
- **Custom Return-Path / SPF for** **send****:**
    
    - MX send.musicschoolsites.com → feedback-smtp.eu-west-1.amazonses.com (prio 10)
        
    - TXT send.musicschoolsites.com → v=spf1 include:amazonses.com ~all
        
    

  

4. **Left Zoho alone for inbound email**
    

  

- Your main **MX (@)** records still point to **Zoho**, so james@, info@, sales@ continue to receive normally.
    

  

5. **DMARC reporting mailbox created**
    

  

- You created **dmarc@musicschoolsites.com** (so reports don’t bounce).
    

  

6. **Next check**
    

  

- Wait for DNS to propagate, then in **Resend** confirm: **Domain verified + DKIM verified + Sending enabled**.
    
- Then send a test email and verify SPF/DKIM/DMARC pass in Gmail “Show original”.


### **1) Install**

```
npm install resend
```

### **2) Add env var**

  

Create/update .env (or .env.local):

```
RESEND_API_KEY=re_xxxxxxxxx
```

### **3) Create an Astro API route**

  

Create:

src/pages/api/test-email.ts

```
import type { APIRoute } from "astro";
import { Resend } from "resend";

export const POST: APIRoute = async () => {
  const apiKey = import.meta.env.RESEND_API_KEY;
  if (!apiKey) return new Response("Missing RESEND_API_KEY", { status: 500 });

  const resend = new Resend(apiKey);

  const { error } = await resend.emails.send({
    from: "Music School Sites <info@musicschoolsites.com>", // must be a verified sender/domain in Resend
    to: ["jamesmcdonaldmusic112@gmail.com"],                // put your test address here
    subject: "Resend test",
    html: "<strong>It works.</strong>",
  });

  if (error) return new Response(JSON.stringify(error), { status: 500 });
  return new Response("Sent", { status: 200 });
};
```

### **4) Run locally**

```
npm run dev
```

### **5) Trigger it (Terminal)**

```
curl -X POST http://localhost:4321/api/test-email
```

If it says **Sent**, check your inbox/spam.

---

## **Option B: send from Resend dashboard**

  

If Resend gives you a “Send test email” UI inside the dashboard, you can use that—but it’s not as useful as testing from your code.

---

### **Important checks if it fails**

- In Resend, the domain must be **Verified** and the **From** address must match what Resend allows (usually something@yourdomain or a specific verified sender).
    
- Don’t use Zoho MX for “receiving” in Resend unless you deliberately want Resend inbound handling. For now, you usually only need **sending**.
    

  

Add this **directly under** what you already have:

---

### **Resend setup — what we did next (after the steps above)**

7. **Added the API route as a real server endpoint (not static)**
    

  

- In src/pages/api/test-email.ts we added:
    
    export const prerender = false;
    
- Reason: this endpoint must run **on request** (server/runtime) so it can use the API key and call Resend.
    

  

8. **Deployed secret to Vercel**
    

  

- Added RESEND_API_KEY in **Vercel → Project → Settings → Environment Variables**.
    
- Reason: Vercel needs the key at runtime (not your local .env).
    

  

9. **Sent a real test from the project**
    

  

- Ran the dev server and triggered the endpoint:
    
    curl -X POST http://localhost:4321/api/test-email
    
- Got Sent, and confirmed email arrived.
    

  

10. **Fixed TypeScript option name**
    

  

- If you want a reply-to, Resend SDK uses replyTo (camelCase), **not** reply_to.
    
- We set: replyTo: "info@musicschoolsites.com".
    

  

11. **Turned off risky/public testing risk (TODO)**
    

  

- Note: /api/test-email is dangerous if public.
    
- Next step is to **protect it** (secret header/token) or delete it after testing.
    

  

12. **Resend deliverability settings chosen (simple defaults)**
    

  

- **Open Tracking:** OFF (can hurt deliverability / inaccurate).
    
- **Click Tracking:** OFF for now (turn on only if you truly need analytics).
    
- **TLS:** Opportunistic (sends even if the recipient server can’t do TLS; “enforced” can cause delivery failures).
    

---