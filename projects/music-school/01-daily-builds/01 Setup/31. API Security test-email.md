## **Purpose**

  

/api/test-email is a **private, admin-only endpoint** used to verify that Resend email sending works.

  

It is **not** used by the public website or inquiry form.

  

Because it can send emails, it must be protected to prevent abuse.

---

## **Why** 

## **x-admin-token**

##  **Exists**

- Browsers do **not** send secret headers
    
- Anyone could otherwise hit /api/test-email and spam emails
    
- We use a **shared secret** stored in environment variables
    
- The server compares the incoming header value to the secret
    

  

This is **intentional design**, not a framework feature.

---

## **How It Works**

1. Server reads a custom HTTP header:
    

```
request.headers.get("x-admin-token")
```

1.   
    
2. Server compares it to:
    

```
import.meta.env.ADMIN_TEST_TOKEN
```

2.   
    
3. If:
    
    - missing → 403 Forbidden
        
    - incorrect → 403 Forbidden
        
    - correct → email is sent
        
    

  

No token = no email.

---

## **Environment Variables Used**

- RESEND_API_KEY
    
    → Authenticates with Resend API
    
- ADMIN_TEST_TOKEN
    
    → Shared secret required to call /api/test-email
    

  

These must **never** be committed to git.

---

## **How to Test (Local)**

  

### **Correct token**

```
curl -i -X POST http://localhost:4321/api/test-email \
  -H "x-admin-token: <ADMIN_TEST_TOKEN>"
```

Expected:

```
200 OK
```

---

### **Wrong token**

```
curl -i -X POST http://localhost:4321/api/test-email \
  -H "x-admin-token: wrong"
```

Expected:

```
403 Forbidden
```

---

### **No token**

```
curl -i -X POST http://localhost:4321/api/test-email
```

Expected:

```
403 Forbidden
```

---

### **Wrong HTTP method**

```
curl -i http://localhost:4321/api/test-email
```

Expected:

```
405 Method Not Allowed
```

---

## **Scope Rule**

- x-admin-token is used **only** for private/admin endpoints
    
- Public endpoints (e.g. /api/inquiry) **must not** require this header
    
- Real users never see or use this token
    

---

## **Status**

  

✅ Endpoint protected

✅ Secrets externalised

✅ Abuse prevented

✅ Matches OWASP guidance

---

